From c54e5c4298c3883dace1c2e2669925a6ac379e07 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Timotej=20=C5=A0i=C5=A1kovi=C4=8D?= <timotej@netdata.cloud>
Date: Mon, 6 Jul 2020 16:56:51 +0200
Subject: [PATCH] fix critical vulnerability in JSON parsing

---
 libnetdata/json/json.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/libnetdata/json/json.c b/libnetdata/json/json.c
index 94f670edf2c..d2407ba4058 100644
--- a/libnetdata/json/json.c
+++ b/libnetdata/json/json.c
@@ -137,10 +137,12 @@ int json_callback_print(JSON_ENTRY *e)
  * @param e the output structure
  */
 static inline void json_jsonc_set_string(JSON_ENTRY *e,char *key,const char *value) {
-    size_t length = strlen(key);
+    size_t len = strlen(key);
+    if(len > JSON_NAME_LEN)
+        len = JSON_NAME_LEN;
     e->type = JSON_STRING;
-    memcpy(e->name,key,length);
-    e->name[length] = 0x00;
+    memcpy(e->name,key,len);
+    e->name[len] = 0x00;
     e->data.string = (char *) value;
 }
 
